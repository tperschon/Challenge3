/*  Fetches the first button in the document it is linked to
    (in this case, index.html)
    with the selector
    (in this case, the id "generate")
    and assigns it an object for use in the script
    */
var generateBtn = document.querySelector("#generate");

/*  Function calling another function we write
    generatePassword() returns a value that is stored in in the password variable
    passwordText gets assigned an object via querySelector similar to above
    passwordText object is a textarea, which has a .value property
    passwordText.value gets assigned our password generated by generatePassword()
    */
function writePassword() {

    var password = generatePassword();
    var passwordText = document.querySelector("#password");
    
    // due to the ! logical operator, if empty string is passed through, nothing happens
    if(!password == "") {
        
        passwordText.value = password;
        
        // one-time appending of "Password Generated" text above the box containing generated password
        // I tried for a long time to figure out how to style this text but it seems it requires extra stuff like AJAX
        if(typeof onlyOnce === 'undefined') {
            document.querySelector('.card-header').append("Password Generated");
            onlyOnce = true;
        }
    }

}

var generatePassword = function() {

    // Initialize returnedPassword as a primitive type string, allowing += assignment to add both numbers and characters to our string
    // This value will be returned by function
    var returnedPassword = "";

    // Store all possible characters that could be used in password generation plus our concatenated string
    var chars = {
        lowerCase: "abcdefghijklmnopqrstuvwxyz",
        upperCase: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
        special: "`~!@#$%^&*()_+-=[]{};':\\\",.<>/?|",
        numbers: "0123456789",
        concatenatedString: ""
    }

    // Ensure user selected at least one character type using comparisons to ensure all are false
    // This loop's conditions will not return true if user selects at least one character type
    while (chars.concatenatedString === "") {
        // confirms to concatenate selected character types to string used to randomly select from overall
        if(confirm("Use lower case letters?"))  {chars.concatenatedString += chars.lowerCase;}
        if(confirm("Use upper case letters?"))  {chars.concatenatedString += chars.upperCase;}
        if(confirm("Use special characters?"))  {chars.concatenatedString += chars.special;}
        if(confirm("Use numbers?"))             {chars.concatenatedString += chars.numbers;}
        // User has not selected at least one character type, so we alert them and go back over character types before moving on
        if(chars.concatenatedString === "") {alert("At least one character type must be selected!");}

    }

    // Final user selection about password length
    var passwordLength = prompt("How many characters, from 8 to 128, would you like your password to be?");

    // If user hits cancel, passwordLength will be null and so we return empty string to cancel out of dialogs
    if (passwordLength === null) {
        return;
    }
    
    // Ensure user selected valid password length and an actual number, but also not a decimal
    while (passwordLength < 8 || passwordLength > 128 || isNaN(passwordLength) || passwordLength.includes(".")) {
        // If user hits cancel, passwordLength will be null and so we return empty string to cancel out of dialogs
        if (passwordLength === null) {
            return;
        }
        passwordLength = prompt(`Invalid entry. You entered \"${passwordLength}\".\nLength must be an integer from 8 to 128 characters.\nHow many characters, from 8 to 128, would you like your password to be?`);
    }

    // Iterates a # of times equal to password length specified by user.
    for (i = 0;i < passwordLength;i++) {
        // Every iteration, pick a random character from the concatenated string and add it to returnedPassword
        returnedPassword += chars.concatenatedString.charAt(Math.floor(Math.random() * chars.concatenatedString.length));
    // Return our now-generated password
    return returnedPassword;
    }
}
/*  With our assigned button object, when clicked, execute writePassword()
    writePassword() does its thing, which has several confirms and prompts for our user
    These prompts collect criteria from user which are used to generate the password
    returnedPassword is returned by generatePassword which passes that value to the textarea
    We can confirm this chain of events by commenting out the addEventListener and manually calling writePassword()
    */
generateBtn.addEventListener("click", writePassword);
// writePassword();